<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="assets/stylesheets/estilo.css">
	<link rel="stylesheet" href="assets/stylesheets/bootstrap.min.css">
</head>
<body>
	<center>
		<h3>M3DU Downloader</h3>
	</center>
	<table style="width:100%">
		<tr>
			<td>
				<label>M3U8 URL:<label>
			</td>
			<td>
				<input type="text" id="url" class="form-control">
			</td>
		</tr>
		<tr>
			<td>
				<label>Numero</label>
			</td>
			<td>
				<input type="text" id="numero" class="form-control">
			</td>
		</tr>
	</table>
	
	<button id="convertir" class="btn btn-success">Convertir</button>
	<div>
		<pre id="result"></pre>
	</div>
	<script type="text/javascript" src="assets/javascripts/jquery-2.1.4.min.js"></script>
	<script type="text/javascript">
		var ffmpeg = require('fluent-ffmpeg');
		var command = ffmpeg();
		
		$(function(){
			$("#convertir").on("click", function()
			{
				var URL 	= $("#url").val();
				var Numero 	= $("#numero").val();
				
				$("#result").html('Inicio de descarga: ');

				var command = ffmpeg(URL)
					.videoCodec('libx264')
  					.audioCodec('libmp3lame')
					.format('mp4')
					.on('start', function(commandLine) {
						console.log('Spawned Ffmpeg with command: ' + commandLine);
						$("#result").html('Spawned Ffmpeg with command: ' + commandLine);
					})
					.on('progress', function(progress) {
						console.log('Processing: ' + progress.percent + '% done');
						$("#result").append("<div id='progress'></div>");
						$("#progress").html('Processing: ' + parseInt(progress.percent) + '% done');
					})
					.on('error', function(err) {
						$("#result").append('An error occurred: ' + err.message);
						console.log('An error occurred: ' + err.message);
					})
					.on('end', function() {
						$("#result").append('<br />Processing finished !');
						console.log('Processing finished !');
					});
				command.save('video'+Numero+'.mp4');
			});
		});
	</script>
</body>
</html>